"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var U={0:8203,1:8204,2:8205,3:8290,4:8291,5:8288,6:65279,7:8289,8:119155,9:119156,a:119157,b:119158,c:119159,d:119160,e:119161,f:119162},M={0:8203,1:8204,2:8205,3:65279},B=new Array(4).fill(String.fromCodePoint(M[0])).join(""),_="\0";function Q(t){let n=JSON.stringify(t);return`${B}${Array.from(n).map(o=>{let e=o.charCodeAt(0);if(e>255)throw new Error(`Only ASCII edit info can be encoded. Error attempting to encode ${n} on character ${o} (${e})`);return Array.from(e.toString(4).padStart(4,"0")).map(r=>String.fromCodePoint(M[r])).join("")}).join("")}`}function q(t){return!Number.isNaN(Number(t))||/[a-z]/i.test(t)&&!/\d+(?:[-:\/]\d+){2}(?:T\d+(?:[-:\/]\d+){1,2}(\.\d+)?Z?)?/.test(t)?!1:!!Date.parse(t)}function H(t){try{new URL(t,t.startsWith("/")?"https://acme.com":void 0)}catch(n){return!1}return!0}function K(t,n,o="auto"){return o===!0||o==="auto"&&(q(t)||H(t))?t:`${t}${Q(n)}`}var X=Object.fromEntries(Object.entries(M).map(t=>t.reverse())),k=Object.fromEntries(Object.entries(U).map(t=>t.reverse())),Y=`${Object.values(U).map(t=>`\\u{${t.toString(16)}}`).join("")}`,b=new RegExp(`[${Y}]{4,}`,"gu");function ee(t){let n=t.match(b);if(n)return te(n[0],!0)[0]}function te(t,n=!1){let o=Array.from(t);if(o.length%2===0){if(o.length%4||!t.startsWith(B))return ne(o,n)}else throw new Error("Encoded data has invalid length");let e=[];for(let r=o.length*.25;r--;){let s=o.slice(r*4,r*4+4).map(c=>X[c.codePointAt(0)]).join("");e.unshift(String.fromCharCode(parseInt(s,4)))}if(n){e.shift();let r=e.indexOf(_);return r===-1&&(r=e.length),[JSON.parse(e.slice(0,r).join(""))]}return e.join("").split(_).filter(Boolean).map(r=>JSON.parse(r))}function ne(t,n){var o;let e=[];for(let i=t.length*.5;i--;){let u=`${k[t[i*2].codePointAt(0)]}${k[t[i*2+1].codePointAt(0)]}`;e.unshift(String.fromCharCode(parseInt(u,16)))}let r=[],s=[e.join("")],c=10;for(;s.length;){let i=s.shift();try{if(r.push(JSON.parse(i)),n)return r}catch(u){if(!c--)throw u;let a=+((o=u.message.match(/\sposition\s(\d+)$/))==null?void 0:o[1]);if(!a)throw u;s.unshift(i.substring(0,a),i.substring(a))}}return r}function re(t){var n;return{cleaned:t.replace(b,""),encoded:((n=t.match(b))==null?void 0:n[0])||""}}function v(t,n){return K(t,n)}function oe(t){return Q(t)}function se(t){return ee(t)}function ce(t){return re(t)}var I,j;function ie(){if(j)return I;j=1;var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString;return I=function(e,r,s){if(n.call(r)!=="[object Function]")throw new TypeError("iterator must be a function");var c=e.length;if(c===+c)for(var i=0;i<c;i++)r.call(s,e[i],i,e);else for(var u in e)t.call(e,u)&&r.call(s,e[u],u,e)},I}var P,D;function ae(){if(D)return P;D=1;var t=ie();P=n;function n(o,e,r){if(arguments.length===3)return n.set(o,e,r);if(arguments.length===2)return n.get(o,e);var s=n.bind(n,o);for(var c in n)n.hasOwnProperty(c)&&(s[c]=n[c].bind(s,o));return s}return n.get=function(e,r){for(var s=Array.isArray(r)?r:n.parse(r),c=0;c<s.length;++c){var i=s[c];if(!(typeof e=="object"&&i in e))throw new Error("Invalid reference token: "+i);e=e[i]}return e},n.set=function(e,r,s){var c=Array.isArray(r)?r:n.parse(r),i=c[0];if(c.length===0)throw Error("Can not set the root object");for(var u=0;u<c.length-1;++u){var a=c[u];typeof a!="string"&&typeof a!="number"&&(a=String(a)),!(a==="__proto__"||a==="constructor"||a==="prototype")&&(a==="-"&&Array.isArray(e)&&(a=e.length),i=c[u+1],a in e||(i.match(/^(\d+|-)$/)?e[a]=[]:e[a]={}),e=e[a])}return i==="-"&&Array.isArray(e)&&(i=e.length),e[i]=s,this},n.remove=function(o,e){var r=Array.isArray(e)?e:n.parse(e),s=r[r.length-1];if(s===void 0)throw new Error('Invalid JSON pointer for remove: "'+e+'"');var c=n.get(o,r.slice(0,-1));if(Array.isArray(c)){var i=+s;if(s===""&&isNaN(i))throw new Error('Invalid array index: "'+s+'"');Array.prototype.splice.call(c,i,1)}else delete c[s]},n.dict=function(e,r){var s={};return n.walk(e,function(c,i){s[i]=c},r),s},n.walk=function(e,r,s){var c=[];s=s||function(i){var u=Object.prototype.toString.call(i);return u==="[object Object]"||u==="[object Array]"},function i(u){t(u,function(a,l){c.push(String(l)),s(a)?i(a):r(a,n.compile(c)),c.pop()})}(e)},n.has=function(e,r){try{n.get(e,r)}catch(s){return!1}return!0},n.escape=function(e){return e.toString().replace(/~/g,"~0").replace(/\//g,"~1")},n.unescape=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},n.parse=function(e){if(e==="")return[];if(e.charAt(0)!=="/")throw new Error("Invalid JSON pointer: "+e);return e.substring(1).split(/\//).map(n.unescape)},n.compile=function(e){return e.length===0?"":"/"+e.map(n.escape).join("/")},P}var p=ae();const G=({pointer:t,mappings:n,data:o,hiddenStrings:e})=>{const r=n[t];if(r){delete n[t];const s=C(o,t);for(const c of s){n[c]=r;const i=p.get(o,c),u=v(i,e);p.set(o,c,u)}}else{const s=C(o,t);for(const c of s){const i=p.get(o,c),u=v(i,e);p.set(o,c,u)}}};function ue(t){return"content"in t&&!!t.content}const C=(t,n="")=>{const o=[],e=p.get(t,n);if(ue(e))for(let r=0;r<e.content.length;r++)e.content[r].nodeType==="text"?o.push(`${n}/content/${r}/value`):o.push(...C(t,`${n}/content/${r}`));return o},$=({entityId:t,entityType:n,space:o,environment:e,field:r,locale:s,editorInterface:c,fieldType:i,targetOrigin:u,platform:a})=>{const d={origin:"contentful.com",href:`${`${u||"https://app.contentful.com"}/spaces/${o}/environments/${e}`}/${n==="Entry"?"entries":"assets"}/${t}/?focusedField=${r}&focusedLocale=${s}&source=vercel-content-link`,contentful:{editorInterface:c,fieldType:i}};return a==="vercel"&&delete d.contentful,d},R=t=>["builtin","sidebar-builtin","editor-builtin"].includes(t),L=t=>z.includes(t);function J(t){if(typeof structuredClone=="function")return structuredClone(t);try{return JSON.parse(JSON.stringify(t))}catch(n){return console.warn("Failed to clone data:",t,n),t}}const z=["singleLine","tagEditor","listInput","checkbox","richTextEditor","multipleLine"];function N(t,n,o,e,r,s,c){const i=c?n[c]:n;switch(t){case"Symbol":{const u=v(i,o);p.set(e,r,u);break}case"Text":{const u=v(i,o);p.set(e,r,u);break}case"RichText":{G({pointer:"",mappings:s,data:i,hiddenStrings:o});break}case"Array":{const u=i.map(a=>typeof a=="string"?v(a,o):a);p.set(e,r,u);break}}}const fe=(t,n,o)=>{if(!t||!t.extensions||!t.extensions.contentSourceMaps)return console.error("GraphQL response does not contain Content Source Maps information.",t),t;const e=J(t),{spaces:r,environments:s,editorInterfaces:c,fields:i,locales:u,entries:a,assets:l,mappings:m,fieldTypes:g}=e.extensions.contentSourceMaps,y=e;for(const d in m){const{source:f}=m[d],h="entry"in f?a[f.entry]:l[f.asset],V="entry"in f?"Entry":"Asset";if(!h)return e;const S=r[h.space],A=s[h.environment],E=h.id,w=i[f.field],x=u[f.locale],O=c[f.editorInterface],F=g[f.fieldType];if(!(R(O.widgetNamespace)&&!L(O.widgetId))&&p.has(y,d)){const W=p.get(y,d);if(W!==null){const Z=$({entityId:E,entityType:V,space:S,environment:A,field:w,locale:x,editorInterface:O,fieldType:F,targetOrigin:n,platform:o});N(F,W,Z,y,d,m)}}}return e},T=(t,n,o,e,r)=>{if(!t.fields)return;const{contentSourceMaps:s}=t.sys;if(!s)return;const{mappings:c}=s;for(const i in c){const{source:u}=c[i],a=t.sys.space.sys.id,l=t.sys.environment.sys.id,m=t.sys.id,g=t.sys.type,y=n[u.fieldType],d=o[u.editorInterface];if(R(d.widgetNamespace)&&!L(d.widgetId))continue;const f=i.startsWith("/")?i:`/${i}`;if(p.has(t,f)){const h=p.get(t,f);if(h===null)return;const S=f.split("/").pop();if(!S){console.error("Field name could not be extracted from the pointer",f);return}const A=t.sys.locale;if(A){const E=$({entityId:m,entityType:g,space:a,environment:l,field:S,locale:A,editorInterface:d,fieldType:y,targetOrigin:e,platform:r});N(y,h,E,t,f,c)}else Object.keys(h).forEach(w=>{const x=$({entityId:m,entityType:g,space:a,environment:l,field:S,locale:w,editorInterface:d,fieldType:y,targetOrigin:e,platform:r});N(y,h,x,t,`${f}/${w}`,c,w)})}}},le=(t,n,o)=>{var r;const e=J(t);if(e.sys&&"items"in e){const s=e;if(!((r=s.sys)!=null&&r.contentSourceMapsLookup))return s;const{contentSourceMapsLookup:{fieldTypes:c,editorInterfaces:i}}=s.sys,{items:u,includes:a}=s;u.forEach(l=>T(l,c,i,n,o)),a&&a.Entry&&a.Entry.forEach(l=>T(l,c,i,n,o)),a&&a.Asset&&a.Asset.forEach(l=>T(l,c,i,n,o))}else{const s=e;if(!s.sys.contentSourceMapsLookup)return console.error("Content source maps lookup data is missing"),s;T(s,s.sys.contentSourceMapsLookup.fieldTypes,s.sys.contentSourceMapsLookup.editorInterfaces,n,o)}return e};exports.SUPPORTED_WIDGETS=z;exports.clone=J;exports.combine=v;exports.createSourceMapMetadata=$;exports.decode=se;exports.encode=oe;exports.encodeCPAResponse=le;exports.encodeField=N;exports.encodeGraphQLResponse=fe;exports.encodeRichTextValue=G;exports.isBuiltinNamespace=R;exports.isSupportedWidget=L;exports.splitEncoding=ce;
//# sourceMappingURL=index.cjs.map
